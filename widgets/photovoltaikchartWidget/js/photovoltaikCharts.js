var months={en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],de:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ru:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],es:["Jan","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],fr:["Jan","Feb","Mar","Apr","Mai","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],it:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pl:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pt:["Jan","Feb","Mar","Apr","Mai","Jun","Jul","Aug","Set","Out","Nov","Dez"],nl:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},days={en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],de:["So","Mo","Di","Mi","Do","Fr","Sa"],ru:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],es:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],fr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],it:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],pl:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],pt:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],nl:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function readOneChart(a,e,t,s,n,o,r,l,i){var d,c={},g=(new Date).getFullYear();c.start=i,c.end=new Date(g,11,31,23,59).getTime(),c.instance=t,c.aggregate="none",c.count=1e3,c.timeout=12e3,console.log(new Date(c.start)+" - "+new Date(c.end)),vis.getHistory(e,c,function(e,t){if(console.log("got History data"),e&&0<Object.keys(e).length&&console.error("Error Object: "+JSON.stringify(e)),!e&&t){for(var i=0;i<t.length;i++)d=new Date(t[i].ts),1===l?a[2*(2-g+d.getFullYear())+o].data[d.getMonth()]=(t[i].val||0)*n:a[o].data[4-g+d.getFullYear()]=(t[i].val||0)*n;t=null}s&&(1===l?a[4+o].data[(new Date).getMonth()]=(vis.states[s+".val"]||0)*n:a[o].data[4]=(vis.states[s+".val"]||0)*n),r&&r()})}function _readData(e,t,i,a,s,n){if((a=a||0)>=t.length)return i&&i();t[a].historyOID&&t[a].instance?readOneChart(e,t[a].historyOID,t[a].instance,t[a].currentOID,t[a].multiplicator,a,function(){setTimeout(function(){_readData(e,t,i,a+1,s,n)},10)},s,n):setTimeout(function(){_readData(e,t,i,a+1,s,n)},10)}function loadSelectorData(s,e,n,o,r,l,t,d){var i=new Date;i.setMonth(-1*t);var c=i.getTime();e&&n?vis.conn.sendTo(n,"query","select id from iobroker.datapoints where name ='"+e+"'",function(e){if(e.error)console.error(e.error),d&&d();else if(console.log("Rows: "+JSON.stringify(e.result)),e.result[0]&&e.result[0].id){var a=e.result[0].id;vis.conn.sendTo(n,"query","select COUNT(ts) AS rowcount from iobroker.ts_number where id="+a+" and ts>"+c,function(e){if(e.error)console.error(e.error),d&&d();else if(console.log("Rows: "+JSON.stringify(e.result)),e.result[0]&&e.result[0].rowcount){var t=e.result[0].rowcount;if(t<1e3)var i="SELECT ts,val FROM iobroker.ts_number where id="+a;else if(t<1e4)i="SELECT * FROM ( SELECT @row := @row +1 AS rownum, ts,val FROM (SELECT @row :=0) r, iobroker.ts_number where id="+a+" and ts>"+c+") ranked WHERE rownum % ("+t+" DIV 1000) = 1";else if(t<5e4)i="SELECT * FROM ( SELECT @row := @row +1 AS rownum, ts,val FROM (SELECT @row :=0) r, iobroker.ts_number where id="+a+" and ts>"+c+") ranked WHERE rownum % ("+t+" DIV 500) = 1";else i="SELECT * FROM ( SELECT @row := @row +1 AS rownum, ts,val FROM (SELECT @row :=0) r, iobroker.ts_number where id="+a+" and ts>"+c+") ranked WHERE rownum % ("+t+" DIV 300) = 1";vis.conn.sendTo(n,"query",i,function(e){if(e.error)console.error(e.error),d&&d();else{for(var t=0;t<e.result.length;t++)eventDate=normalizeDate(new Date(e.result[t].ts),l),console.log(eventDate+":"+e.result[t].val),s.push([eventDate.getTime(),(e.result[t].val||0)*r]);res=null,o&&s.push([normalizeDate(new Date,l).getTime(),(vis.states[o+".val"]||0)*r]),d&&d()}})}else d&&d()})}else d&&d()}):d&&d()}function readOneLineRange(a,e,t,s,n,o,r,i,l,d,c,g){var u,h={},m=new Date(0),p=((new Date).getFullYear(),[]);d<i&&p.push([d,0]),h.start=i,h.end=l,h.instance=t,h.aggregate="minmax",h.timeout=12e3,console.log(JSON.stringify(h)),console.log("Load Range for "+e+" "+new Date(h.start)+" - "+new Date(h.end)),vis.getHistory(e,h,function(e,t){if(e&&0<Object.keys(e).length&&console.error("Error Object: "+JSON.stringify(e)),!e&&t){console.log("got History data. Count:"+t.length);for(var i=0;i<t.length;i++)u=normalizeDate(new Date(t[i].ts),r),null!=t[i].val&&(m.getTime()==u.getTime()?p[p.length-1][1]=(t[i].val||0)*n:(p.push([u.getTime(),(t[i].val||0)*n]),m=u));t=null}s&&p.push([normalizeDate(new Date,r).getTime(),(vis.states[s+".val"]||0)*n]),l<c&&p.push([c,0]),a.series[o].setData(p,!1),g&&g()})}function readAndAddOneLineRange(a,e,t,s,n,o,i,r,l,d){var c,g={},u=new Date(0),h=((new Date).getFullYear(),[]);g.start=i,g.end=r,g.instance=t,g.aggregate="minmax",g.timeout=12e3,console.log("Load Range for "+e+" "+new Date(g.start)+" - "+new Date(g.end)),vis.getHistory(e,g,function(e,t){if(e&&0<Object.keys(e).length&&console.error("Error Object: "+JSON.stringify(e)),!e&&t){console.log("got History data. Count:"+t.length);for(var i=0;i<t.length;i++)c=normalizeDate(new Date(t[i].ts),o),null!=t[i].val&&(u.getTime()==c.getTime()?h[h.length-1][1]=(t[i].val||0)*s:(h.push([c.getTime(),(t[i].val||0)*s]),u=c));t=null,0<h.length&&l<h[h.length-1][0]&&(l=h[h.length-1][0]);for(i=0;i<h.length;i++)a.series[n].addPoint(h[i],!1,!1,!1,!1)}d&&d(l)})}function loadSeriesRange(e,t,i,a,s,n,o,r,l){if((i=i||0)>=t.length)return l&&l();t[i].historyOID&&t[i].instance?readOneLineRange(e,t[i].historyOID,t[i].instance,t[i].currentOID,t[i].multiplicator,i,a,s,n,o,r,function(){setTimeout(function(){loadSeriesRange(e,t,i+1,a,s,n,o,r,l)},10)}):setTimeout(function(){loadSeriesRange(e,t,i+1,a,s,n,o,r,l)},10)}function loadAndAddSeriesRange(t,i,a,s,n,o,e,r){if((a=a||0)>=i.length)return r&&r(e);i[a].historyOID&&i[a].instance?readAndAddOneLineRange(t,i[a].historyOID,i[a].instance,i[a].multiplicator,a,s,n,o,e,function(e){setTimeout(function(){loadAndAddSeriesRange(t,i,a+1,s,n,o,e,r)},10)}):setTimeout(function(){loadAndAddSeriesRange(t,i,a+1,s,n,o,e,r)},10)}function normalizeDate(e,t){if("hour"==t)e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0);else if("day"==t)e.setUTCMilliseconds(0),e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(0);else{if("week"==t){var i=e.getDay(),a=e.getDate()-i+(0==i?-6:1);return(e=new Date(e.setDate(a))).setUTCMilliseconds(0),e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(0),e}"month"==t?(e.setUTCMilliseconds(0),e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCDate(1)):"year"==t&&(e.setUTCMilliseconds(0),e.setUTCSeconds(0),e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCDate(1),e.setUTCMonth(0))}return e}var minDate=new Date(2020,0,1).getTime();!function(u){u.Chart.prototype.pan=function(f,e){var t,y,i,D=this,a=D.hoverPoints,s=D.options.chart;t="object"==typeof e?e:{enabled:e,type:"x"},s&&s.panning&&(s.panning=t),i=t.type,u.fireEvent(this,"pan",{originalEvent:f},function(){a&&a.forEach(function(e){e.setState()});var e=[1];"xy"===i?e=[1,0]:"y"===i&&(e=[0]),e.forEach(function(e){var t,i=D[e?"xAxis":"yAxis"][0],a=i.options,s=i.horiz,n=f[s?"chartX":"chartY"],o=s?"mouseDownX":"mouseDownY",r=D[o],l=(i.pointRange||0)/2,d=i.reversed&&!D.inverted||!i.reversed&&D.inverted?-1:1,c=i.getExtremes(),g=i.toValue(r-n,!0)+l*d,u=i.toValue(r+i.len-n,!0)-l*d,h=u<g,m=h?u:g,p=h?g:u,v=minDate,x=(new Date).getTime();a.ordinal||(e&&(0<(t=v-m)&&(p+=t,m=v),0<(t=p-x)&&(p=x,m-=t)),(i.series.length&&m!==c.min&&p!==c.max&&e||i.panningState&&m>=i.panningState.startMin&&p<=i.panningState.startMax)&&(i.setExtremes(m,p,!1,!1,{trigger:"pan"}),y=!0),D[o]=n)}),y&&D.redraw(!1),u.css(D.container,{cursor:"move"})})},u.Chart.prototype.zoom=function(e){console.log("Chart Zoom handler ");var o,r=this,l=r.pointer,d=r.inverted?l.mouseDownX:l.mouseDownY,c=!1;!e||e.resetSelection?(r.axes.forEach(function(e){o=e.zoom()}),l.initiated=!1):e.xAxis.concat(e.yAxis).forEach(function(e){var t=e.axis,i=r.inverted?t.left:t.top,a=r.inverted?i+t.width:i+t.height,s=t.isXAxis,n=!1;(!s&&i<=d&&d<=a||s||!u.defined(d))&&(n=!0),l[s?"zoomX":"zoomY"]&&n&&(o=t.zoom(e.min,e.max),t.displayBtn&&(c=!0))});var t=r.resetZoomButton;c&&!t?r.showResetZoom():!c&&u.isObject(t)&&(r.resetZoomButton=t.destroy()),o&&r.redraw(u.pick(r.options.chart.animation,e&&e.animation,r.pointCount<100))},u.Axis.prototype.zoom=function(e,t){console.log("Axis Zoom handler min:"+new Date(e)+" max:"+new Date(t));var i,a,s=this;(s=this.chart)&&s.navigator&&s.navigator.xAxis&&(a=s.navigator.xAxis.min,i=s.navigator.xAxis.max);var n=this,o=this.dataMin,r=this.dataMax,l=this.options,d=Math.min(o,u.pick(l.min,o),a),c=Math.max(r,u.pick(l.max,r),i),g={newMin:e,newMax:t};return u.fireEvent(this,"zoom",g,function(e){var t=e.newMin,i=e.newMax;t===n.min&&i===n.max||(n.allowZoomOutside||(u.defined(o)&&(t<d&&(t=d),c<t&&(t=c)),u.defined(r)&&(i<d&&(i=d),c<i&&(i=c))),n.displayBtn=!1,n.setExtremes(t,i,!1,void 0,{trigger:"zoom"})),e.zoomed=!0}),g.zoomed},u.Pointer.prototype.pinch=function(e){console.log("Pointer pinch handler ");var t=this,r=t.chart,i=t.pinchDown,a=e.touches||[],s=a.length,n=t.lastValidTouch,o=t.hasZoom,l={},d=1===s&&(t.inClass(e.target,"highcharts-tracker")&&r.runTrackerClick||t.runChartClick),c={},g=t.selectionMarker;1<s?t.initiated=!0:1===s&&this.followTouchMove&&(t.initiated=!1),o&&t.initiated&&!d&&!1!==e.cancelable&&e.preventDefault(),[].map.call(a,function(e){return t.normalize(e)}),"touchstart"===e.type?([].forEach.call(a,function(e,t){i[t]={chartX:e.chartX,chartY:e.chartY}}),n.x=[i[0].chartX,i[1]&&i[1].chartX],n.y=[i[0].chartY,i[1]&&i[1].chartY],r.axes.forEach(function(e){if(e.zoomEnabled){var t=r.bounds[e.horiz?"h":"v"],i=e.minPixelPadding,a=e.toPixels(Math.min(u.pick(e.options.min,e.dataMin),e.dataMin,minDate)),s=e.toPixels(Math.max(u.pick(e.options.max,e.dataMax),e.dataMax,(new Date).getTime())),n=Math.min(a,s),o=Math.max(a,s);t.min=Math.min(e.pos,n-i),t.max=Math.max(e.pos+e.len,o+i)}}),t.res=!0):t.followTouchMove&&1===s?this.runPointActions(t.normalize(e)):i.length&&(u.fireEvent(r,"touchpan",{originalEvent:e},function(){g||(t.selectionMarker=g=extend({destroy:u.noop,touch:!0},r.plotBox)),t.pinchTranslate(i,a,l,g,c,n),t.hasPinched=o,t.scaleGroups(l,c)}),t.res&&(t.res=!1,this.reset(!1,0)))}}(Highcharts);var types=["DOMMouseScroll","mousewheel"];function handler(e){var t=e||window.event,i=[].slice.call(arguments,1),a=0,s=0,n=0;return(e=$.event.fix(t)).type="mousewheel",e.wheelDelta&&(a=e.wheelDelta/120),e.detail&&(a=-e.detail/3),n=a,void 0!==t.axis&&t.axis===t.HORIZONTAL_AXIS&&(n=0,s=-1*a),void 0!==t.wheelDeltaY&&(n=t.wheelDeltaY/120),void 0!==t.wheelDeltaX&&(s=-1*t.wheelDeltaX/120),i.unshift(e,a,s,n),$.event.handle.apply(this,i)}$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=types.length;e;)this.addEventListener(types[--e],handler,!1);else this.onmousewheel=handler},teardown:function(){if(this.removeEventListener)for(var e=types.length;e;)this.removeEventListener(types[--e],handler,!1);else this.onmousewheel=null}},$.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}}),vis.binds.photovoltaikcharts={version:"1.0.1",updateIntervalHandler:[],delayedRefreshHandler:[],showVersion:function(){vis.binds.photovoltaikcharts.version&&(console.log("Version vis-photovoltaikcharts: "+vis.binds.photovoltaikcharts.version),vis.binds.photovoltaikcharts.version=null)},highchartsOptions:{lang:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],weekdays:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortWeekdays:["So","Mo","Di","Mi","Do","Fr","Sa"],shortMonths:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],contextButtonTitle:"Kontextmenü",decimalPoint:",",downloadCSV:"CSV-Datei herunterladen",downloadJPEG:"JPG-Datei herunterladen",downloadPDF:"PDF-Datei herunterladen",downloadPNG:"PNG-Datei herunterladen",downloadSVG:"SVG-Datei herunterladen",downloadXLS:"XLS-Datei herunterladen",exitFullscreen:"Vollbildanzeige beenden",hideData:"Datentabellen ausblenden",loading:"Laden...",noData:"Keine Daten",numericSymbols:["k","M","G","T","P","E"],printChart:"Diagramm drucken",resetZoom:"Zoom zurücksetzen",resetZoomTitle:"Zoom auf 1:1 zurücksetzen",viewData:"Datentabelle anzeigen",viewFullscreen:"Als Vollbild anzeigen",exportData:{annotationHeader:"Anmerkungen",categoryDatetimeHeader:"Datum/Zeit",categoryHeader:"Kategorie"}}},highchartsSeriesUnits:[["second",[1]],["minute",[1]],["hour",[1]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]],highchartsDateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%e. %b",week:"%e. %b",month:"%b '%y",year:"%Y"},scrollspeed:.3,createMonthlyWidget:function(t,e,i,a){var s=[],n=[],o=null,r=null,l=this;console.log(" vis-photovoltaikcharts: Create Monthly Widget");var d=$("#"+t);if(!d.length)return setTimeout(function(){l.createMonthlyWidget(t,e,i,a)},100);console.log("Initialize Chart Widget #"+t);var c="en";"undefined"!=typeof sysLang&&(c=sysLang||"en"),i.target&&(o=i.target.split(",")),n=[{id:0,historyOID:i.series1historyoid,instance:i.instance1,currentOID:i.series1currentoid,multiplicator:parseFloat(i.multiplicator1)||1},{id:1,historyOID:i.series2historyoid,instance:i.instance2,currentOID:i.series2currentoid,multiplicator:parseFloat(i.multiplicator2)||1}];var g=(new Date).getFullYear(),u=[[0,0,0],[.8,0,0],[1.7,0,0],[2.6,0,0],[3.5,0,0],[4.7,0,0],[5.7,0,0],[6.7,0,0],[7.6,0,0],[8.6,0,0],[9.5,0,0],[10.4,0,0],[11.4,0,0]],h=[g.toString(),(g-1).toString(),(g-2).toString()];if(s=[{name:(i.series1label||"E")+" "+(g-2).toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:2,color:i.year3color2||"#2f7ed8",opacity:.9},{name:(i.series2label||"V")+" "+(g-2).toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:2,color:i.year3color1||"#0d233a",opacity:.9},{name:(i.series1label||"E")+" "+(g-1).toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:1,color:i.year2color2||"#FE642E",showInLegend:!0,opacity:.9},{name:(i.series2label||"V")+" "+(g-1).toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:1,color:i.year2color1||"#FF4000",showInLegend:!0,opacity:.9},{name:(i.series1label||"E")+" "+g.toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:0,color:i.year1color2||"#F7D358",showInLegend:!0,opacity:.9},{name:(i.series2label||"V")+" "+g.toString().substr(-2),data:[0,0,0,0,0,0,0,0,0,0,0,0],stack:0,color:i.year1color1||"#DBA901",showInLegend:!0,opacity:.9}],Array.isArray(o)){for(var m=0;m<o.length;m++)u[m][1]=parseFloat(o[m]);s.push({type:"scatter",lineWidth:2,name:i.targetName||"Target",step:"left",data:u,color:"#A4A4A4",marker:{enabled:!1}})}function p(e,t,i){r&&r.series[4].data[(new Date).getMonth()].update((parseFloat(t)||0)*n[0].multiplicator)}function v(e,t,i){r&&r.series[5].data[(new Date).getMonth()].update((parseFloat(t)||0)*n[1].multiplicator)}"de"===vis.language&&Highcharts.setOptions(l.highchartsOptions),_readData(s,n,function(){var e=i.unit;r=Highcharts.chart("chart_placeholder"+t,{chart:{width:d.width()-2,height:d.height()-2,zoomType:"x",type:"column",options3d:{enabled:!0,alpha:i.alpha||8,beta:i.beta||8,depth:i.depth||200,viewDistance:i.viewDistance||5,frame:{bottom:{size:1,color:"rgba(0,0,0,0.05)"}}}},title:{text:i.title},xAxis:{categories:months[c]},yAxis:{title:{text:e}},zAxis:{min:0,max:2,labels:{y:5,rotation:18},categories:h},plotOptions:{column:{stacking:"normal"},series:{groupZPadding:10,depth:50,groupPadding:.05,grouping:!1}},legend:{enabled:i.showLegend},exporting:{enabled:i.showMenu},tooltip:{formatter:function(){return this.point.stackTotal?"<b>"+this.x+" "+this.series.chart.zAxis[0].options.categories[this.series.userOptions.stack]+"</b><br/>"+this.series.name+": "+this.y+"<br/>"+(i.stacklabel||"Erzeugung:")+" "+this.point.stackTotal+(Array.isArray(o)?"<br/>"+(i.targetName||"Target")+": "+o[this.point.x]:""):"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y}},series:s,credits:{enabled:!1}})},0,1,new Date(g-2,0,1).getTime()),i.series1currentoid&&(vis.states.bind(i.series1currentoid+".val",p),d.data("bound",[i.series1currentoid+".val"]),d.data("bindHandler",p)),i.series2currentoid&&(vis.states.bind(i.series2currentoid+".val",v),d.data("bound",[i.series2currentoid+".val"]),d.data("bindHandler",v))},createYearlyWidget:function(t,e,i,a){var s,n=[],o=null,r=this;console.log(" vis-photovoltaikcharts: Create Yearly Widget");var l=$("#"+t);if(!l.length)return setTimeout(function(){r.createYearlyWidget(t,e,i,a)},100);console.log("Initialize Chart Widget #"+t);"undefined"!=typeof sysLang&&sysLang,n=[{id:0,historyOID:i.series1historyoid,instance:i.instance1,currentOID:i.series1currentoid,multiplicator:parseFloat(i.multiplicator1)||1},{id:1,historyOID:i.series2historyoid,instance:i.instance2,currentOID:i.series2currentoid,multiplicator:parseFloat(i.multiplicator2)||1},{id:2,historyOID:i.series3historyoid,instance:i.instance3,currentOID:i.series3currentoid,multiplicator:parseFloat(i.multiplicator3)||1},{id:3,historyOID:i.series4historyoid,instance:i.instance4,currentOID:i.series4currentoid,multiplicator:parseFloat(i.multiplicator4)||1},{id:4,historyOID:i.series5historyoid,instance:i.instance5,currentOID:i.series5currentoid,multiplicator:parseFloat(i.multiplicator5)||1}];var d=(new Date).getFullYear(),c=[d-4,d-3,d-2,d-1,d];s=[{name:i.series1label,data:[0,0,0,0,0],color:i.series1color||"#2f7ed8",opacity:.9},{name:i.series2label,data:[0,0,0,0,0],color:i.series2color||"#0d233a",opacity:.9},{name:i.series3label,data:[0,0,0,0,0],color:i.series3color||"#33FF3B",opacity:.9},{name:i.series4label,data:[0,0,0,0,0],color:i.series4color||"#FF8F33",opacity:.9},{name:i.series5label,data:[0,0,0,0,0],color:i.series5color||"#F433FF",opacity:.9}];var g=[];function u(e,t,i){o&&o.series[0].data[4].update((parseFloat(t)||0)*n[0].multiplicator)}function h(e,t,i){o&&o.series[1].data[4].update((parseFloat(t)||0)*n[1].multiplicator)}function m(e,t,i){o&&o.series[2].data[4].update((parseFloat(t)||0)*n[2].multiplicator)}function p(e,t,i){o&&o.series[3].data[4].update((parseFloat(t)||0)*n[3].multiplicator)}function v(e,t,i){o&&o.series[4].data[4].update((parseFloat(t)||0)*n[4].multiplicator)}i.target&&g.push({color:"#33FF50",dashStyle:"Solid",label:i.targetName||"Target",value:parseFloat(i.target),width:2}),_readData(s,n,function(){"de"===vis.language&&Highcharts.setOptions(r.highchartsOptions);var e=i.unit;o=Highcharts.chart("chart_placeholder"+t,{chart:{width:l.width()-2,height:l.height()-2,zoomType:"x",type:"column",options3d:{enabled:!0,alpha:i.alpha||8,beta:i.beta||8,depth:i.depth||50,viewDistance:i.viewDistance||5,frame:{bottom:{size:1,color:"rgba(0,0,0,0.05)"}}}},title:{text:i.title},xAxis:{categories:c},yAxis:{title:{text:e},plotLines:g},series:{groupZPadding:10,depth:50,groupPadding:.05,grouping:!1},legend:{enabled:i.showLegend},exporting:{enabled:i.showMenu},tooltip:{formatter:function(){return this.point.stackTotal?"<b>"+this.x+" "+this.series.chart.zAxis[0].options.categories[this.series.userOptions.stack]+"</b><br/>"+this.series.name+": "+this.y+"<br/>"+(i.stacklabel||"Erzeugung:")+" "+this.point.stackTotal+(Array.isArray(null)?"<br/>"+(i.targetName||"Target")+": "+null[this.point.x]:""):"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y}},series:s,credits:{enabled:!1}})},0,2,new Date(d-4,0,1).getTime()),i.series1currentoid&&(vis.states.bind(i.series1currentoid+".val",u),l.data("bound",[i.series1currentoid+".val"]),l.data("bindHandler",u)),i.series2currentoid&&(vis.states.bind(i.series2currentoid+".val",h),l.data("bound",[i.series2currentoid+".val"]),l.data("bindHandler",h)),i.series3currentoid&&(vis.states.bind(i.series3currentoid+".val",m),l.data("bound",[i.series3currentoid+".val"]),l.data("bindHandler",m)),i.series4currentoid&&(vis.states.bind(i.series4currentoid+".val",p),l.data("bound",[i.series4currentoid+".val"]),l.data("bindHandler",p)),i.series5currentoid&&(vis.states.bind(i.series5currentoid+".val",v),l.data("bound",[i.series5currentoid+".val"]),l.data("bindHandler",v))},createTimeseriesWidget:function(t,e,r,i){var a=[],l=[],n="chart_placeholder",d=null,o=this,c=!1,s=!1,g=null,u=[];console.log(" photovoltaikcharts: Create Timeseries Widget");var h=$("#"+t);if(!h.length)return setTimeout(function(){o.createTimeseriesWidget(t,e,r,i)},100);console.log("Initialize Chart Widget #"+t);"undefined"!=typeof sysLang&&sysLang,l=[],a=[];var m,p=0;for(m=1;m<7;m++)r["series"+m+"historyoid"]&&r["instance"+m]&&(l.push({id:p,historyOID:r["series"+m+"historyoid"],instance:r["instance"+m],currentOID:r["series"+m+"currentoid"],multiplicator:parseFloat(r["multiplicator"+m])||1,lastX:0}),a.push({name:r["series"+m+"label"],data:[],color:r["series"+m+"color"]||"#FF5A33",lineWidth:r["series"+m+"linewidth"]||1,fillOpacity:r["series"+m+"opacity"]?parseFloat(r["series"+m+"opacity"])/100:.3,type:r["series"+m+"Type"]||"areaspline",yAxis:r["series"+m+"axis"]?parseInt(r["series"+m+"axis"]):0,step:r["series"+m+"step"]&&"no"!=r["series"+m+"step"]?r["series"+m+"step"]:void 0,stacking:r["series"+m+"stacking"]&&"no"!=r["series"+m+"stacking"]?r["series"+m+"stacking"]:void 0,dataGrouping:{enabled:!0,approximation:"high",units:o.highchartsSeriesUnits},states:{hover:{enabled:!0,lineWidth:r["series"+m+"hoverlinewidth"]||1}},pointInterval:1e4}),p++);var v=[];function x(e,t,i){if(console.log("resize chart to "+new Date(e)+" - "+new Date(t)),!1,e&&t){c=!0;var a=e,s=t;d.showLoading(),window.setTimeout(function(){loadSeriesRange(d,l,0,r.normalizeDate,e,t,a,s,function(){d.redraw(),d.hideLoading(),c=!1,i&&i()})},10)}}r.target&&v.push({color:"#33FF50",dashStyle:"Solid",label:r.targetName||"Target",value:parseFloat(r.target),width:2}),o.delayedRefreshHandler[t]&&window.clearInterval(o.delayedRefreshHandler[t]),o.delayedRefreshHandler[t]=window.setInterval(function(){0==c&&1==s&&(s=!1,console.log("Process event "+new Date(g.min)+" - "+new Date(g.max)),x(g.min,g.max))},500),"de"===vis.language&&Highcharts.setOptions(o.highchartsOptions);var f=r.unit;function y(e,t,i){if(d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(console.log("add new series 1 value :"+a+"("+a.getTime()+") - "+t),d.navigator.series[0].points&&0<d.navigator.series[0].points.length&&d.navigator.series[0].points[d.navigator.series[0].points.length-1]&&console.log("Last old x:"+d.navigator.series[0].points[d.navigator.series[0].points.length-1].x),d.navigator.series[0].points&&0<d.navigator.series[0].points.length&&d.navigator.series[0].points[d.navigator.series[0].points.length-1]&&d.navigator.series[0].points[d.navigator.series[0].points.length-1].x==a.getTime()?d.navigator.series[0].points[d.navigator.series[0].points.length-1].update((parseFloat(t)||0)*l[0].multiplicator):d.navigator.series[0].addPoint([a.getTime(),(parseFloat(t)||0)*l[0].multiplicator]),d.series[0].points&&d.series[0].points[d.series[0].points.length-1]&&d.series[0].points[d.series[0].points.length-1].x==a.getTime())console.log("Update series 1"),d.series[0].points[d.series[0].points.length-1].update((parseFloat(t)||0)*l[0].multiplicator);else if(console.log("Add new value to series 1"),d&&d.xAxis&&void 0!==d.xAxis[0]){var s=d.xAxis[0].getExtremes();console.log("Old extremes: "+JSON.stringify(s));var n=d.navigator.xAxis.max;if(console.log("Last X: "+new Date(n)),console.log("CompareX: "+JSON.stringify(s)),console.log("oldExtremes max: "+new Date(s.max)),s.max>n-6e5){d.series[0].addPoint([a.getTime(),(parseFloat(t)||0)*l[0].multiplicator]);var o=d.navigator.xAxis.max;n!=o&&d.xAxis[0].setExtremes(s.min+o-s.max,o)}}}}function D(e,t,i){if(console.log("Update series 2"),d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(d.series[1].points&&d.series[1].points[d.series[1].points.length-1]&&d.series[1].points[d.series[1].points.length-1].x==a.getTime())d.series[1].points[d.series[1].points.length-1].update((parseFloat(t)||0)*l[1].multiplicator);else if(d&&d.xAxis&&void 0!==d.xAxis[1]){var s=d.xAxis[1].getExtremes(),n=d.series&&d.series[1].points&&0<d.series[1].points.length&&d.series[1].points[d.series[1].points.length-1]&&d.series[1].points[d.series[1].points.length-1].x?d.series[1].points[d.series[1].points.length-1].x:0;s.max>n-6e5&&d.series[1].addPoint([a.getTime(),(parseFloat(t)||0)*l[1].multiplicator])}}}function w(e,t,i){if(console.log("Update series 3"),d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(d.series[2].points&&d.series[2].points[d.series[2].points.length-1]&&d.series[2].points[d.series[2].points.length-1].x==a.getTime())d.series[2].points[d.series[2].points.length-1].update((parseFloat(t)||0)*l[2].multiplicator);else if(d&&d.xAxis&&void 0!==d.xAxis[0]){var s=d.xAxis[0].getExtremes(),n=d.series&&d.series[2].points&&0<d.series[2].points.length&&d.series[2].points[d.series[2].points.length-1]&&d.series[2].points[d.series[2].points.length-1].x?d.series[2].points[d.series[2].points.length-1].x:0;s.max>n-6e5&&d.series[2].addPoint([a.getTime(),(parseFloat(t)||0)*l[2].multiplicator])}}}function T(e,t,i){if(console.log("Update series 4"),d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(d.series[3].points&&d.series[3].points[d.series[3].points.length-1]&&d.series[3].points[d.series[3].points.length-1].x==a.getTime())d.series[3].points[d.series[3].points.length-1].update((parseFloat(t)||0)*l[3].multiplicator);else if(d&&d.xAxis&&void 0!==d.xAxis[0]){var s=d.xAxis[0].getExtremes(),n=d.series&&d.series[3].points&&0<d.series[3].points.length&&d.series[3].points[d.series[3].points.length-1]&&d.series[3].points[d.series[3].points.length-1].x?d.series[3].points[d.series[3].points.length-1].x:0;s.max>n-6e5&&d.series[3].addPoint([a.getTime(),(parseFloat(t)||0)*l[3].multiplicator])}}}function b(e,t,i){if(console.log("Update series 5"),d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(d.series[4].points&&d.series[4].points[d.series[4].points.length-1]&&d.series[4].points[d.series[4].points.length-1].x==a.getTime())d.series[4].points[d.series[4].points.length-1].update((parseFloat(t)||0)*l[4].multiplicator);else if(d&&d.xAxis&&void 0!==d.xAxis[0]){var s=d.xAxis[0].getExtremes(),n=d.series&&d.series[4].points&&0<d.series[4].points.length&&d.series[4].points[d.series[4].points.length-1]&&d.series[4].points[d.series[4].points.length-1].x?d.series[4].points[d.series[4].points.length-1].x:0;s.max>n-6e5&&d.series[4].addPoint([a.getTime(),(parseFloat(t)||0)*l[4].multiplicator])}}}function A(e,t,i){if(console.log("Update series 6"),d&&t!=i){var a=normalizeDate(new Date,r.normalizeDate);if(d.series[5].points&&d.series[5].points[d.series[5].points.length-1]&&d.series[5].points[d.series[5].points.length-1].x==a.getTime())d.series[5].points[d.series[5].points.length-1].update((parseFloat(t)||0)*l[5].multiplicator);else if(d&&d.xAxis&&void 0!==d.xAxis[0]){var s=d.xAxis[0].getExtremes(),n=d.series&&d.series[5].points&&0<d.series[5].points.length&&d.series[5].points[d.series[5].points.length-1]&&d.series[5].points[d.series[5].points.length-1].x?d.series[5].points[d.series[5].points.length-1].x:0;s.max>n-6e5&&d.series[5].addPoint([a.getTime(),(parseFloat(t)||0)*l[5].multiplicator])}}}d=Highcharts.stockChart(n+t,{chart:{width:h.width()-2,height:h.height()-2,zoomType:"x",renderTo:n+t,panning:!0,panKey:"shift"},title:{text:r.title},time:{timezoneOffset:"no"==r.normalizeDate||"hour"==r.normalizeDate?(new Date).getTimezoneOffset():0},rangeSelector:{buttons:[{type:"day",count:1,text:"1 Tag",title:"1 Tag anzeigen"},{type:"day",count:3,text:"3 Tage",title:"3 Tage anzeigen"},{type:"day",count:7,text:"7 Tage",title:"7 Tage anzeigen"},{type:"month",count:1,text:"1M",title:"1 Monat anzeigen"},{type:"month",count:3,text:"3M",title:"3 Monate anzeigen"},{type:"month",count:6,text:"6M",title:"6 Monate anzeigen"},{type:"ytd",text:"Aktuelles Jahr",title:"Aktuelles Jahr anzeigen"},{type:"year",count:1,text:"1 Jahr",title:"1 Jahr anzeigen"},{type:"all",text:"Alles",title:"Alles anzeigen"}],allButtonsEnabled:!0,dropdown:"always",height:10,selected:{"1d":0,"3d":1,"7d":2,"1m":3,"3m":4,"6m":5,ytd:6,"1y":7,all:8}[r.zoomDefault],inputDateFormat:"%e. %b %Y"},navigator:{adaptToUpdatedData:!1,height:20,margin:10,series:[{data:null,dataGrouping:{enabled:!0,approximation:"high",units:o.highchartsSeriesUnits},pointInterval:1e4}],xAxis:{ordinal:!1}},scrollbar:{enabled:!1},xAxis:{events:{afterSetExtremes:function(e){console.log("afterSetExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger),null!=e.trigger&&(c?(g=e,console.log("Save event "+new Date(e.min)+" - "+new Date(e.max)),s=!0):x(e.min,e.max))},setExtremes:function(e){console.log("setExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger)}},dateTimeLabelFormats:o.highchartsDateTimeLabelFormats,overscroll:1e4,ordinal:!1},yAxis:[{labels:{formatter:function(){return this.value+" "+f},align:"left"},title:{text:"Produktion"},height:r.chart1Height?r.chart1Height+"%":"48%",lineWidth:2,resize:{enabled:!0},plotLines:v,min:r.yAxis1min?parseFloat(r.yAxis1min):void 0,max:r.yAxis1max?parseFloat(r.yAxis1max):void 0,tickAmount:r.yAxis1tickamount?r.yAxis1tickamount:void 0,minorTicks:!0},{labels:{formatter:function(){return this.value+" "+f},align:"left"},title:{text:"Verbrauch"},top:r.chart1Height?parseFloat(r.chart1Height)+(r.chartspacing?parseFloat(r.chartspacing):4)+"%":48+(r.chartspacing?parseFloat(r.chartspacing):5)+"%",height:r.chart2Height?r.chart2Height+"%":"48%",offset:0,lineWidth:2,min:r.yAxis2min?parseFloat(r.yAxis2min):void 0,max:r.yAxis2max?parseFloat(r.yAxis2max):void 0,tickAmount:r.yAxis2tickamount?r.yAxis2tickamount:void 0,minorTicks:!0}],plotOptions:{},legend:{enabled:r.showLegend,align:"left",verticalAlign:"top",x:0,y:20,floating:!0},exporting:{enabled:r.showMenu},credits:{enabled:!1},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',valueDecimals:2,split:!0,followTouchMove:!1,dateTimeLabelFormats:o.highchartsDateTimeLabelFormats},series:a}),window.setTimeout(function(){loadSelectorData(u,l[0].historyOID,l[0].instance,l[0].currentOID,l[0].multiplicator,r.normalizeDate,r.navigatorRange?parseInt(r.navigatorRange):48,function(){d.navigator.series[0].setData(u),d.navigator.series[0].xAxis.min=u[0][0];var e=new Date;e.setUTCMilliseconds(0),e.setUTCSeconds(0),"1d"==r.zoomDefault?e.setDate(e.getDate()-1):"7d"==r.zoomDefault?e.setDate(e.getDate()-7):"3d"==r.zoomDefault?e.setDate(e.getDate()-3):"1m"==r.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-1)):"3m"==r.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-3)):"6m"==r.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-6)):"ytd"==r.zoomDefault?e=new Date(e.getFullYear(),0,1):"1y"==r.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-12)):"all"==r.zoomDefault&&(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-120)),x(e.getTime(),(new Date).getTime());var s=0;$("#"+n+t).mousewheel(function(e,t){0<t?(s=-1*o.scrollspeed,i()):t<0&&(s=o.scrollspeed,i())});var i=function(){var e=d.xAxis[0].getExtremes().dataMin,t=d.xAxis[0].getExtremes().dataMax,i=minDate,a=(new Date).getTime();d.xAxis[0].setExtremes(Math.max(i,e-s*(t-e)),Math.min(a,t+s*(t-e)),!0,!0,{trigger:"zoom"})}})},10),r.series1currentoid&&(console.log("register on changes for "+r.series1currentoid),vis.states.bind(r.series1currentoid+".val",y),h.data("bound",[r.series1currentoid+".val"]),h.data("bindHandler",y)),r.series2currentoid&&(console.log("register on changes for "+r.series2currentoid),vis.states.bind(r.series2currentoid+".val",D),h.data("bound",[r.series2currentoid+".val"]),h.data("bindHandler",D)),r.series3currentoid&&(console.log("register on changes for "+r.series3currentoid),vis.states.bind(r.series3currentoid+".val",w),h.data("bound",[r.series3currentoid+".val"]),h.data("bindHandler",w)),r.series4currentoid&&(console.log("register on changes for "+r.series4currentoid),vis.states.bind(r.series4currentoid+".val",T),h.data("bound",[r.series4currentoid+".val"]),h.data("bindHandler",T)),r.series5currentoid&&(console.log("register on changes for "+r.series5currentoid),vis.states.bind(r.series5currentoid+".val",b),h.data("bound",[r.series5currentoid+".val"]),h.data("bindHandler",b)),r.series6currentoid&&(console.log("register on changes for "+r.series6currentoid),vis.states.bind(r.series6currentoid+".val",A),h.data("bound",[r.series6currentoid+".val"]),h.data("bindHandler",A))},createTimeseries2Widget:function(d,e,n,t){var i=[],o=[],a="chart_placeholder",c=null,g=this,r=!1,s=!1,l=null,u=[];console.log(" photovoltaikcharts: Create Timeseries2 Widget");var h=$("#"+d);if(!h.length)return setTimeout(function(){g.createTimeseries2Widget(d,e,n,t)},100);console.log("Initialize Chart Widget #"+d);"undefined"!=typeof sysLang&&sysLang;var m={id:0,historyOID:n.navhistoryoid,instance:n.navinstance,multiplicator:parseFloat(n.navmultiplicator)||1};o=[],i=[];var p,v=0;for(p=1;p<6;p++)n["series"+p+"historyoid"]&&n["instance"+p]&&(o.push({id:v,historyOID:n["series"+p+"historyoid"],instance:n["instance"+p],multiplicator:parseFloat(n["multiplicator"+p])||1,lastX:0}),i.push({name:n["series"+p+"label"],data:[],color:n["series"+p+"color"]||"#FF5A33",lineWidth:n["series"+p+"linewidth"]||1,fillOpacity:n["series"+p+"opacity"]?parseFloat(n["series"+p+"opacity"])/100:.3,type:n["series"+p+"Type"]||"areaspline",yAxis:n["series"+p+"axis"]?parseInt(n["series"+p+"axis"]):0,step:n["series"+p+"step"]&&"no"!=n["series"+p+"step"]?n["series"+p+"step"]:void 0,stacking:n["series"+p+"stacking"]&&"no"!=n["series"+p+"stacking"]?n["series"+p+"stacking"]:void 0,dataGrouping:{enabled:!0,approximation:"high",units:g.highchartsSeriesUnits},states:{hover:{enabled:!0,lineWidth:n["series"+p+"hoverlinewidth"]||1}},pointInterval:1e4}),v++);var x=[];function f(e,t,i){if(console.log("resize chart to "+new Date(e)+" - "+new Date(t)),!1,e&&t){r=!0;var a=e,s=t;console.log("virtual chart size "+new Date(a)+" - "+new Date(s)),c.showLoading(),window.setTimeout(function(){loadSeriesRange(c,o,0,n.normalizeDate,e,t,a,s,function(){c.redraw(),c.hideLoading(),r=!1,i&&i()})},10)}}n.target&&x.push({color:"#33FF50",dashStyle:"Solid",label:n.targetName||"Target",value:parseFloat(n.target),width:2}),g.delayedRefreshHandler[d]&&window.clearInterval(g.delayedRefreshHandler[d]),g.delayedRefreshHandler[d]=window.setInterval(function(){0==r&&1==s&&(s=!1,console.log("Process event "+new Date(l.min)+" - "+new Date(l.max)),f(l.min,l.max))},500),"de"===vis.language&&Highcharts.setOptions(g.highchartsOptions);var y=n.unit;function D(){if(console.log("Start update chart"),c){var e,t,a,s,n,o,i,r=c.xAxis[0].getExtremes(),l=c.navigator.xAxis.max;console.log("Start UpdateSelector "+new Date(l)+" - "+new Date(r.dataMax)),e=m.historyOID,t=m.instance,a=m.multiplicator,s=function(){if(c.navigator.series[0].data[c.navigator.series[0].data.length-1].x>l&&r.max>l-6e5){var e=c.navigator.xAxis.max;c.xAxis[0].setExtremes(r.min+e-r.max,e,!0,!0,{trigger:"zoom"})}},(i={}).start=l+1,i.instance=t,i.aggregate="minmax",i.limit=300,i.timeout=12e3,vis.getHistory(e,i,function(e,t){if(e&&0<Object.keys(e).length&&console.error("Error Object: "+JSON.stringify(e)),!e&&t){console.log("got History data. Count:"+t.length);for(var i=0;i<t.length;i++)n=new Date(t[i].ts),o=t[i].val*a,null!=t[i].val&&(c.navigator.series[0].data&&0<c.navigator.series[0].data.length&&c.navigator.series[0].data[c.navigator.series[0].data.length-1]&&c.navigator.series[0].data[c.navigator.series[0].data.length-1].x==n.getTime()?c.navigator.series[0].data[c.navigator.series[0].data.length-1].update(o):c.navigator.series[0].addPoint([n.getTime(),o]));t=null}s&&s()})}else g.updateIntervalHandler[d]&&(window.clearInterval(g.updateIntervalHandler[d]),g.updateIntervalHandler[d]=null)}c=Highcharts.stockChart(a+d,{chart:{width:h.width()-2,height:h.height()-2,zoomType:"x",renderTo:a+d,panning:!0,panKey:"shift"},title:{text:n.title},time:{useUTC:!1},rangeSelector:{buttons:[{type:"day",count:1,text:"1 Tag",title:"1 Tag anzeigen"},{type:"day",count:3,text:"3 Tage",title:"3 Tage anzeigen"},{type:"day",count:7,text:"7 Tage",title:"7 Tage anzeigen"},{type:"month",count:1,text:"1M",title:"1 Monat anzeigen"},{type:"month",count:3,text:"3M",title:"3 Monate anzeigen"},{type:"month",count:6,text:"6M",title:"6 Monate anzeigen"}],allButtonsEnabled:!0,dropdown:"always",height:10,selected:{"1d":0,"3d":1,"7d":2,"1m":3,"3m":4,"6m":5}[n.zoomDefault],inputDateFormat:"%e. %b %Y"},navigator:{adaptToUpdatedData:!1,height:20,margin:10,series:[{data:null,dataGrouping:{enabled:!0,approximation:"high",units:g.highchartsSeriesUnits},pointInterval:1e4}],xAxis:{ordinal:!1}},scrollbar:{enabled:!1},xAxis:{events:{afterSetExtremes:function(e){console.log("afterSetExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger),null!=e.trigger&&(r?(l=e,console.log("Save event "+new Date(e.min)+" - "+new Date(e.max)),s=!0):f(e.min,e.max))},setExtremes:function(e){console.log("setExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger)}},ordinal:!1,dateTimeLabelFormats:g.highchartsDateTimeLabelFormats},yAxis:[{labels:{formatter:function(){return this.value},align:"left",x:1},title:{text:n.xAxisLabel1},height:n.chart1Height?n.chart1Height+"%":"20%",lineWidth:1,resize:{enabled:!0},categories:n.yAxis1Categories?JSON.parse(n.yAxis1Categories):void 0,offset:0,min:n.yAxis1min?parseFloat(n.yAxis1min):void 0,max:n.yAxis1max?parseFloat(n.yAxis1max):void 0,tickAmount:n.yAxis1tickamount?n.yAxis1tickamount:void 0,minorTicks:!0,startOnTick:!1},{labels:{formatter:function(){return this.value+" "+y},align:"left",x:1},title:{text:n.xAxisLabel2},top:n.chart1Height?parseFloat(n.chart1Height)+(n.chartspacing?parseFloat(n.chartspacing):5)+"%":20+(n.chartspacing?parseFloat(n.chartspacing):5)+"%",height:n.chart2Height?n.chart2Height+"%":"40%",lineWidth:2,resize:{enabled:!0},categories:n.yAxis2Categories?JSON.parse(n.yAxis2Categories):void 0,offset:0,plotLines:x,min:n.yAxis2min?parseFloat(n.yAxis2min):void 0,max:n.yAxis2max?parseFloat(n.yAxis2max):void 0,tickAmount:n.yAxis2tickamount?n.yAxis2tickamount:void 0,minorTicks:!0},{labels:{formatter:function(){return this.value+" "+y},align:"left",x:1},title:{text:n.xAxisLabel3},categories:n.yAxis3Categories?JSON.parse(n.yAxis3Categories):void 0,top:(n.chart1Height?parseFloat(n.chart1Height)+(n.chartspacing?parseFloat(n.chartspacing):5):20+(n.chartspacing?parseFloat(n.chartspacing):5))+(n.chart2Height?parseFloat(n.chart2Height)+(n.chartspacing?parseFloat(n.chartspacing):5):40+(n.chartspacing?parseFloat(n.chartspacing):5))+"%",height:n.chart3Height?n.chart3Height+"%":"30%",offset:0,lineWidth:2,min:n.yAxis3min?parseFloat(n.yAxis3min):void 0,max:n.yAxis3max?parseFloat(n.yAxis3max):void 0,tickAmount:n.yAxis3tickamount?n.yAxis3tickamount:void 0,minorTicks:!0}],plotOptions:{},legend:{enabled:n.showLegend,align:"left",verticalAlign:"top",x:0,y:20,floating:!0},exporting:{enabled:n.showMenu},credits:{enabled:!1},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',valueDecimals:2,split:!0,followTouchMove:!1,dateTimeLabelFormats:g.highchartsDateTimeLabelFormats},series:i}),window.setTimeout(function(){loadSelectorData(u,m.historyOID,m.instance,null,m.multiplicator,"no",n.navigatorRange?parseInt(n.navigatorRange):3,function(){c.navigator.series[0].setData(u),c.navigator.series[0].xAxis.min=u[0][0];var e=new Date;e.setUTCMilliseconds(0),e.setUTCSeconds(0),"1d"==n.zoomDefault?e.setDate(e.getDate()-1):"3d"==n.zoomDefault?e.setDate(e.getDate()-3):"7d"==n.zoomDefault?e.setDate(e.getDate()-7):"1m"==n.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-1)):"3m"==n.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-3)):"6m"==n.zoomDefault&&(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-6)),f(e.getTime(),(new Date).getTime(),function(){g.updateIntervalHandler[d]&&window.clearInterval(g.updateIntervalHandler[d]);var s=0;$("#"+a+d).mousewheel(function(e,t){0<t?(s=-1*g.scrollspeed,i()):t<0&&(s=g.scrollspeed,i())});var i=function(){var e=c.xAxis[0].getExtremes().dataMin,t=c.xAxis[0].getExtremes().dataMax,i=minDate,a=(new Date).getTime();c.xAxis[0].setExtremes(Math.max(i,e-s*(t-e)),Math.min(a,t+s*(t-e)),!0,!0,{trigger:"zoom"})};g.updateIntervalHandler[d]=window.setInterval(function(){D()},3e4)})})},10)},createTimeseries3Widget:function(n,e,o,t){var i=[],r=[],a="chart_placeholder",l=null,d=this,c=!1,s=!1,g=null;console.log(" photovoltaikcharts: Create Timeseries3 Widget");var u=$("#"+n);if(!u.length)return setTimeout(function(){d.createTimeseries3Widget(n,e,o,t)},100);console.log("Initialize Chart Widget #"+n);"undefined"!=typeof sysLang&&sysLang;var h=o.unit;r=[],i=[];var m,p,v=0;for(m=1;m<5;m++)o["series"+m+"historyoid"]&&o["instance"+m]&&(p=o["series"+m+"label"],r.push({id:v,historyOID:o["series"+m+"historyoid"],instance:o["instance"+m],multiplicator:parseFloat(o["multiplicator"+m])||1,lastX:0}),i.push({name:p,data:[],color:o["series"+m+"color"]||"#FF5A33",lineWidth:o["series"+m+"linewidth"]||1,fillOpacity:o["series"+m+"opacity"]?parseFloat(o["series"+m+"opacity"])/100:.3,type:o["series"+m+"Type"]||"areaspline",step:o["series"+m+"step"]&&"no"!=o["series"+m+"step"]?o["series"+m+"step"]:void 0,stacking:o["series"+m+"stacking"]&&"no"!=o["series"+m+"stacking"]?o["series"+m+"stacking"]:void 0,dataGrouping:{enabled:!0,approximation:"high",units:d.highchartsSeriesUnits},states:{hover:{enabled:!0,lineWidth:o["series"+m+"hoverlinewidth"]||1}},pointInterval:1e4}),v++);function x(e,t,i){if(console.log("resize chart to "+new Date(e)+" - "+new Date(t)),!1,e&&t){c=!0;var a=e,s=t;l.showLoading(),window.setTimeout(function(){loadSeriesRange(l,r,0,o.normalizeDate,e,t,a,s,function(){l.redraw(),l.hideLoading(),c=!1,i&&i()})},10)}}o.target&&[].push({color:"#33FF50",dashStyle:"Solid",label:o.targetName||"Target",value:parseFloat(o.target),width:2}),d.delayedRefreshHandler[n]&&window.clearInterval(d.delayedRefreshHandler[n]),d.delayedRefreshHandler[n]=window.setInterval(function(){0==c&&1==s&&(s=!1,console.log("Process event "+new Date(g.min)+" - "+new Date(g.max)),x(g.min,g.max))},500),"de"===vis.language&&Highcharts.setOptions(d.highchartsOptions);vis.states[o.series1historyoid];function f(){if(console.log("Start update chart"),l){var e,t,i,a=l.xAxis[0].getExtremes();0==c&&(new Date).getTime()-6e5<a.max&&(e=a.dataMax,t=(new Date).getTime(),i=function(e){l.xAxis[0].setExtremes(a.dataMin+e-a.dataMax,e),console.log("Updated chart data to "+new Date(a.dataMin+e-a.dataMax)+" - "+new Date(e))},console.log("load and add new Data for "+new Date(e)+" - "+new Date(t)),e&&t&&window.setTimeout(function(){loadAndAddSeriesRange(l,r,0,o.normalizeDate,e,t,e,function(e){i&&i(e)})},10))}else d.updateIntervalHandler[n]&&(window.clearInterval(d.updateIntervalHandler[n]),d.updateIntervalHandler[n]=null)}function y(e,t,i){if(console.log("Change zoom"),l&&t!=i&&o.zoomoid&&vis.states[o.zoomoid+".val"]){var a=l.xAxis[0].getExtremes(),s=new Date(new Date(a.dataMax).getTime()-1e3*t);l.xAxis[0].setExtremes(s.getTime(),a.dataMax,!0,!0,{trigger:"zoom"})}}l=new Highcharts.stockChart(a+n,{chart:{width:u.width()-2,height:u.height()-2,zoomType:"x",panning:!0,panKey:"shift",renderTo:a+n,backgroundColor:"rgba(255,255,255,0)"},title:{text:o.title},time:{useUTC:!1},rangeSelector:{enabled:!1,buttons:[{type:"day",count:1,text:"1 Tag",title:"1 Tag anzeigen"},{type:"day",count:3,text:"3 Tage",title:"3 Tage anzeigen"},{type:"day",count:7,text:"7 Tage",title:"7 Tage anzeigen"},{type:"month",count:1,text:"1M",title:"1 Monat anzeigen"},{type:"month",count:3,text:"3M",title:"3 Monate anzeigen"},{type:"month",count:6,text:"6M",title:"6 Monate anzeigen"}],allButtonsEnabled:!0,dropdown:"always",height:10,inputDateFormat:"%e. %b %Y"},navigator:{enabled:!1,series:[{data:null,dataGrouping:{enabled:!0,approximation:"high",units:d.highchartsSeriesUnits},pointInterval:1e4}],xAxis:{ordinal:!1}},scrollbar:{enabled:!1},xAxis:{events:{afterSetExtremes:function(e){console.log("afterSetExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger),null!=e.trigger&&(c?(g=e,console.log("Save event "+new Date(e.min)+" - "+new Date(e.max)),s=!0):x(e.min,e.max))},setExtremes:function(e){console.log("setExtremes event "+new Date(e.min)+" - "+new Date(e.max)+" - "+e.trigger)}},ordinal:!1,dateTimeLabelFormats:d.highchartsDateTimeLabelFormats},yAxis:[{labels:{formatter:function(){return this.value+" "+h},align:"left",x:1},lineWidth:2,offset:0,categories:o.yAxis1Categories?JSON.parse(o.yAxis1Categories):void 0,min:o.yAxis1min?parseFloat(o.yAxis1min):void 0,max:o.yAxis1max?parseFloat(o.yAxis1max):void 0,tickAmount:o.yAxis1tickamount?o.yAxis1tickamount:void 0,minorTicks:!0,startOnTick:!1}],plotOptions:{},legend:{enabled:o.showLegend,align:"left",verticalAlign:"top",x:0,y:2,floating:!0},exporting:{enabled:o.showMenu},credits:{enabled:!1},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',valueDecimals:2,split:!0,followTouchMove:!1,dateTimeLabelFormats:d.highchartsDateTimeLabelFormats},series:i}),window.setTimeout(function(){var e=new Date;e.setUTCMilliseconds(0),e.setUTCSeconds(0),o.zoomoid&&vis.states[o.zoomoid+".val"]?(console.log("use range info from zoomid:"+vis.states[o.zoomoid+".val"]+" type "+typeof vis.states[o.zoomoid+".val"]),e=new Date((new Date).getTime()-1e3*vis.states[o.zoomoid+".val"])):"1d"==o.zoomDefault?e.setDate(e.getDate()-1):"3d"==o.zoomDefault?e.setDate(e.getDate()-3):"7d"==o.zoomDefault?e.setDate(e.getDate()-7):"1m"==o.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-1)):"3m"==o.zoomDefault?(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-3)):"6m"==o.zoomDefault&&(e.setUTCMinutes(0),e.setUTCHours(0),e.setUTCMonth(e.getMonth()-6)),x(e.getTime(),(new Date).getTime(),function(){l.xAxis[0].allowZoomOutside=!0;var s=0;$("#"+a+n).mousewheel(function(e,t){0<t?(s=-1*d.scrollspeed,i()):t<0&&(s=d.scrollspeed,i())});var i=function(){var e=l.xAxis[0].getExtremes().dataMin,t=l.xAxis[0].getExtremes().dataMax,i=minDate,a=(new Date).getTime();l.xAxis[0].setExtremes(Math.max(i,e-s*(t-e)),Math.min(a,t+s*(t-e)),!0,!0,{trigger:"zoom"})};d.updateIntervalHandler[n]&&window.clearInterval(d.updateIntervalHandler[n]),d.updateIntervalHandler[n]=window.setInterval(function(){f()},3e4)})},10),o.zoomoid&&(console.log("register on changes for "+o.zoomoid),vis.states.bind(o.zoomoid+".val",y),u.data("bound",[o.zoomoid+".val"]),u.data("bindHandler",y))}},vis.binds.photovoltaikcharts.showVersion();
//# sourceMappingURL=photovoltaikCharts.js.map
